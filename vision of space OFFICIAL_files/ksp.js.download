(function($){var Helpers={};var PS_STORE_LOCALES=['en-US','en-GB','es-AR','en-AU','nl-BE','fr-BE','en-BH','ar-BH','es-BO','pt-BR','en-BG','en-CA','fr-CA','zh-Hans-CN','es-CL','es-CO','es-CR','en-HR','en-CY','en-CZ','da-DK','en-DK','de-DE','es-EC','es-SV','es-ES','en-FI','fr-FR','en-GR','es-GT','es-HN','zh-Hans-HK','zh-Hant-HK','en-HK','en-HU','en-IS','en-IN','en-ID','en-IE','en-IL','it-IT','ja-JP','ko-KR','en-KW','ar-KW','en-LB','ar-LB','fr-LU','de-LU','en-MY','en-MT','es-MX','es-NI','nl-NL','en-NZ','no-NO','en-NO','en-OM','ar-OM','de-AT','es-PA','es-PY','es-PE','en-PL','pl-PL','pt-PT','en-QA','ar-QA','en-RO','ru-RU','en-SA','ar-SA','de-CH','en-SG','en-SK','en-SI','en-ZA','fr-CH','fi-FI','sv-SE','it-CH','en-SE','zh-Hant-TW','en-TW','en-TH','en-TR','tr-TR','ru-UA','es-UY','en-AE','ar-AE'];var PS_STORE_LOCALES_MAP={'ja':'ja-JP','ru':'ru-RU','ko':'ko-KR','pl':'pl-PL','zh-HK':'zh-Hans-HK','zh-CN':'zh-Hans-CN','zh-TW':'zh-Hant-TW'}
var PS_STORE_LINK_TEMPLATE='https://store.playstation.com/<% locale %>/product/EP4829-CUSA11258_00-KERBAL0EE0000000';var PS_STORE_TARGET='.js-ps-store a';Helpers.setPsStoreLocaleLink=function(el){var preferredLocales=navigator.languages;var localeFlag=false;for(var i=0;i<preferredLocales.length;i++){if(PS_STORE_LOCALES.indexOf(preferredLocales[i])>-1){el.setAttribute('href',PS_STORE_LINK_TEMPLATE.replace('<% locale %>',preferredLocales[i]));localeFlag=true
break;}}
if(!localeFlag){for(var i=0;i<preferredLocales.length;i++){if(PS_STORE_LOCALES_MAP[preferredLocales[i]]){el.setAttribute('href',PS_STORE_LINK_TEMPLATE.replace('<% locale %>',PS_STORE_LOCALES_MAP[preferredLocales[i]]));break;}}}};var psStoreLink=document.querySelector(PS_STORE_TARGET);if(psStoreLink){Helpers.setPsStoreLocaleLink(psStoreLink);}
var canSubmit=true;var initSubscribe=function(){$('.js-subscribe').on('submit',function(e){e.preventDefault();$('.subscribe-form__wrapper').addClass('submitting');clearErrors();var formData=$(this).serializeArray();var data={};formData.forEach(function(field){data[field.name]=field.value;});if(hasErrors(data)){$('.subscribe-form__wrapper').removeClass('submitting');return;};if(!validateAge(getDateString(),getValidAge())){$('.subscribe-form__wrapper').removeClass('submitting');showAgeError();return;};data['action']='pd_subscribe';if(canSubmit){canSubmit=false;$.ajax({type:"POST",url:pd_vars.pd_ajax_url,data:data,success:function(resp){var json=JSON.parse(resp);if(json.keys){showSuccess();canSubmit=true;}else{showGeneralError();canSubmit=true;}}});}});};var clearErrors=function(){$('.subscribe-form__email').removeClass('error');$('select[name="month"]').removeClass('error');$('select[name="year"]').removeClass('error');$('select[name="country"]').removeClass('error');$('input[name="agreement"]').removeClass('error');$('.js-age-error').hide();$('.js-general-error').hide();}
var hasErrors=function(data){var errors=false;if(!data['email']){$('.subscribe-form__email').addClass('error');errors=true;}
if(!data['month']){$('select[name="month"]').addClass('error');errors=true;}
if(!data['year']){$('select[name="year"]').addClass('error');errors=true;}
if(!data['country']){$('select[name="country"]').addClass('error');errors=true;}
if(!data['agreement']){$('input[name="agreement"]').addClass('error');errors=true;}
return errors;}
var showAgeError=function(){$('select[name="month"]').addClass('error');$('select[name="year"]').addClass('error');$('.js-age-req').text(getValidAge());$('.js-age-error').show();}
var showGeneralError=function(){$('.subscribe-form__wrapper').removeClass('submitting');$('.js-general-error').show();}
var showSuccess=function(){$('.subscribe-form__wrapper').addClass('success');}
var getAge=function(dateString){var today=new Date();var birthDate=new Date(dateString);var age=today.getFullYear()-birthDate.getFullYear();var m=today.getMonth()-birthDate.getMonth();if(m<0||(m===0&&today.getDate()<birthDate.getDate())){age--;}
return age;}
var validateAge=function(dateString,ageMin){return getAge(dateString)>=ageMin}
var getDateString=function(){var month=$('select[name="month"]').val(),year=$('select[name="year"]').val();return month+'/1/'+year;};var getValidAge=function(){return parseInt($('select[name="country"] option:checked')[0].getAttribute('data-age'),10);}
var NEWSLETTER_KEY='newsletterDismissed';var NEWSLETTER_MODAL_DELAY=5000;if(localStorage&&!localStorage.getItem(NEWSLETTER_KEY)){setTimeout(function(){$('.subscribe-form__modal').fadeIn('fast');},NEWSLETTER_MODAL_DELAY);}
$('.subscribe-form__close').on('click',function(){$('.subscribe-form__modal').fadeOut('fast');localStorage.setItem(NEWSLETTER_KEY,'true');});initSubscribe();var blogLoadMore=function(){var loadMoreIndex=1;$('.js-ksp-load-more').on('click',function(e){e.preventDefault();loadMoreIndex++;$('.js-ksp-load-more-container').addClass('submitting');$.ajax({url:'/community/page/'+loadMoreIndex+'/'}).done(function(data){var $next=$(data).find('.blog-masonry--flex').children();$('.js-ksp-load-more-container .blog-masonry--flex').append($next);$('.tm-animation').addClass('animate');$('.js-ksp-load-more-container').removeClass('submitting');if($(data).find('.js-ksp-load-more-container .insight-pagination .current').next().length===0){$('.js-ksp-load-more').hide();}})});};if($('.js-ksp-load-more-container').length){blogLoadMore();}})(jQuery);